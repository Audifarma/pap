<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>pap</title>
        <!--        <meta HTTP-EQUIV="Content-Type" content="text/html; charset=iso-8859-1" /> -->
        <script type="text/javascript" src="cordova.js"></script>
        <link rel="stylesheet" href="JQ/jquery.mobile-1.4.5.min.css" />
        <link href="css/themes/1/conf-room1.min.css" rel="stylesheet" />
        <link href="css/themes/1/jquery.mobile.icons.min.css" rel="stylesheet"/>
        <link rel="stylesheet" href="css/app.css"/>
        <script src="JQ/jquery.min.js"></script>
        <script src="JQ/jquery.mobile-1.4.5.min.js"></script>
        <script src="js/markerwithlabel.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=geometry"></script>
        <script src="./js/util.js"></script>
        <script src="./js/pap.js"></script>
        <script src="./js/app.js"></script>

        <script src="JQ/fastclick.min.js"></script>

        <script src="js/signin-controller.js" type="text/javascript"></script>
        <script src="js/settings.js" type="text/javascript"></script>
        <script src="js/session.js"></script>
        <script src="js/api-messages.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script src="js/signup-controller.js"></script>

        <script>
            function iniciarConfirmacion()
            {
                cargarMapa();
                cargarAutorizacionesUsuario();
            }
            function cargarMapa() {
                $(document).on("pageinit", "#confirmar", function (e, data) {
                    var defaultPos = new google.maps.LatLng(4.807259, -75.744327);
                    function esperarGps() {
                        cordova.plugins.diagnostic.isLocationEnabled(
                                function (enabled) {
                                    if (enabled) {
                                        setTimeout(validarGps, 4000)
                                    }
                                    else {
                                        setTimeout(esperarGps, 4000)
                                    }
                                }, function (error) {
                            console.error("Error: " + error);
                        });
                    }
                    function opcionesNoGps(buttonIndex) {
                        if (buttonIndex == 1) {
                            alert("Listado de los centros de atención");
                            MuestraMapa(defaultPos);
                        }
                        if (buttonIndex == 2) {
                            cordova.plugins.diagnostic.switchToLocationSettings();
                            esperarGps();
                        }
                    }
                    function validarGps() {
                        if (navigator.geolocation) {
                            function exito(pos) {
                                MuestraMapa(new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude));
                            }
                            function falla(error) {
                                navigator.notification.confirm(
                                        'Se recomienda Activar el GPS para que el proceso sea automático. \nSi lo prefiere puede Seleccionar el centro de atención manualmente. ', // message
                                        opcionesNoGps, // callback to invoke
                                        'GPS Desactivado', // title
                                        ['Mostrar los Centros', 'Activar GPS']             // buttonLabels
                                        );
                            }
                            //maximumAge- Guarda la posicion por 5 minutos 
                            //enableHighAccuracy: Se tratan de obtener los mejores resultados posible del GPS
                            //timeout: el tiempo maximo que se espera para obtener la posicion en este caso 5 segundos
                            var options = {maximumAge: 500000, enableHighAccuracy: true, timeout: 5000};
                            navigator.geolocation.getCurrentPosition(exito, falla, options);
                        }//FIN IF
                        else {
                            MuestraMapa(defaultPos);  // No soporta geolocalizacion y dibuja el mapa en posicion Default
                        }
                    }
                    //FUNCION DIBUJAR MAPa
                    function MuestraMapa(latlng) {

                        var myOptions = {
                            zoom: 13,
                            center: latlng,
                            disableDefaultUI: true,
                            mapTypeId: google.maps.MapTypeId.ROADMAP};

                        var map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
                        var infowindow = new google.maps.InfoWindow({position: latlng, content: '<p>Mi posición</p>' + latlng});
                        var infowindowCaf = new google.maps.InfoWindow({position: latlng, content: '<p>Nombre de Caf</p>'});

                        var marker = new google.maps.Marker({
                            position: latlng,
                            map: map,
                            title: "Mi posición",
                            animation: google.maps.Animation.DROP});

                        setMarkers(map);
                        function setMarkers(map) {
                            var distancia;
                            var cafImgen = 'images/audifarma.png';
                            var cafs = [
                                {nombre: 'caf 2', latitud: 4.807572, longitud: -75.731000, posicion: 1, distancia: 0},
                                {nombre: 'caf 1', latitud: 4.804423, longitud: -75.739497, posicion: 2, distancia: 0}
                            ];
                            for (var i = 0; i < cafs.length; i++) {
                                var caf = cafs[i];
                                var marker = new google.maps.Marker({
                                    position: {lat: caf.latitud, lng: caf.longitud},
                                    map: map,
                                    icon: cafImgen,
                                    title: caf.nombre,
                                    zIndex: caf.posicion,
                                    label: caf.posicion.toString()
                                });
                                distancia = google.maps.geometry.spherical.computeDistanceBetween(latlng, new google.maps.LatLng(caf.latitud, caf.longitud));
                                cafs[i].distancia = distancia;
                                ventana_detalle(marker, distancia.toFixed(0).toString());
                            }

                            cafs.sort(function (a, b) {
                                var a1 = a.distancia, b1 = b.distancia;
                                if (a1 == b1)
                                    return 0;
                                return a1 < b1 ? 1 : -1;
                            });

                            for (var i = 0; i < cafs.length; i++) {
                                var caf = cafs[i];
                                $('#cafs').append('<option value="' + caf.nombre + '">' + caf.nombre + '</option>');
                            }
                            $('#cafs').selectmenu('refresh');

                        }

                        function ventana_detalle(marker, distancia) {
                            var infowindow = new google.maps.InfoWindow({
                                content: '<div style="color: black;">' + marker.title + '<br> La Distancia al caf es: ' + distancia + ' metros</div>'
                            });

                            marker.addListener('click', function () {
                                infowindow.open(marker.get('map'), marker);
                            });
                        }




                        //google.maps.event.addListener(marker, 'click', function() {infowindow.open(map,marker);});
                        //google.maps.event.addListener(caf, "click", function (e) { infowindowCaf.open(map, this); });

                    }// Fin muestra mapa
                    validarGps();
                });

            }
        </script>
        <style>
            #map-canvas{
                height:70%;
                width:100%;
                padding:0;
                position:absolute !important;
                top:40px;
                righ:0px;
                bottom:0px !important;
                left:0px !important;
            }
            .labels {
                color: red;
                background-color: white;
                font-family: "Lucida Grande", "Arial", sans-serif;
                font-size: 10px;
                font-weight: bold;
                text-align: center;
                width: 40px;     
                border: 2px solid black;
                white-space: nowrap;
            }
        </style>
    </head>

    <body>
        <div data-role="page" id="page-index">
            <div data-role="header" data-theme="c" data-position="fixed">
                <h1>PAP</h1>
            </div><!-- /header -->
            <div role="main" class="ui-content">
                <h2 class="bi-text-center">Bienvenido!</h2>
                <p class="bi-top-margin-1-5"><b>Usuario Existente</b></p>
                <a href="#page-signin" class="ui-btn ui-btn-b ui-corner-all">Inicia Sesión</a>
                <p class="bi-top-margin-1-5"><b>Aún no tienes cuenta?</b></p>
                <a href="#divRegistrarUsuario" class="ui-btn ui-btn-b ui-corner-all">Registrate</a>
                <p></p>
            </div><!-- /content -->
        </div><!-- /page -->
        <div data-role="page" id="pap" style="background-color: #1CAAA0;color: white;text-align: center">        	

            <div role="main" class="ui-content">
                <img src="images/cabecera.png" alt="PAP" style="width: 100%">
                <div class="ui-grid-a">
                    <div class="ui-block-a" onclick="iniciarConfirmacion(), location.href = '#confirmar'"><div class="ui-bar" style="height:150px;background-color: #660099;color:white;font-weight:none;padding-top: 20px">Confirmar Orden</div></a></div>
                    <div class="ui-block-b">                                            <div class="ui-bar" style="height:150px;background-color: #FF9900;color:white;font-weight:none;padding-top: 20px">Mis Órdenes</div></div>
                </div><!-- /grid-a -->

                <div class="ui-grid-a">
                    <div class="ui-block-a">                                        <div class="ui-bar" style="height:150px;background-color: #009933;color:white;font-weight:none;padding-top: 20px">Información de Domicilio</div></div>
                    <div class="ui-block-b">                                        <div class="ui-bar" style="height:150px;background-color: #FF0066;color:white;font-weight:none;padding-top: 20px">Utilidades</div></div>
                </div><!-- /grid-a -->

                <!--<div class="ui-grid-a">
                    <div class="ui-block-a" onclick="location.href = '#divLogin'">                                        
                        <div class="ui-bar" style="height:150px;background-color: #FF9900;color:white;font-weight:none;padding-top: 20px">
                            Ingresar
                        </div>
                    </div>
                    <div class="ui-block-b" onclick="location.href = '#divRegistrarUsuario'">
                        <div class="ui-bar" style="height:150px;background-color: #660099;color:white;font-weight:none;padding-top: 20px">
                            Registrar Usuario
                        </div>
                    </div>
                </div>-->

            </div><!-- /content -->

        </div>

        <div id="confirmar" data-role="page" data-url="map-page" style="background-color: #1CAAA0;color: white">
            <div data-role="header" data-position="fixed" style="background-color: #660099;color: white;">
                <a href="#" class="ui-btn ui-corner-all ui-icon-carat-l ui-btn-icon-notext" data-rel="back">Back Icon</a>
                <h1>Confirmar</h1>
            </div>
            <div id="paginaMapa" role="main" class="ui-content">
                <div id="map-canvas">
                </div>
                <div style="position: absolute;top: 75%;padding: 5%">
                    <h3>Caf más cercano según tu posición</h3>
                    <select id="cafs" name="select-choice-1" style="background-color: #660099;color: white;"></select>
                    <h3>Nombre</h3>&nbsp;&nbsp;&nbsp;&nbsp;Juan David Montoya
                    <h3>Autorización </h3>
                    <select id="autorizaciones" name="select-choice-2" style="background-color: #660099;color: white;"></select>
                    <button class="ui-btn ui-btn-b ui-corner-all" style="background-color: #660099;color: white;border: none">
                        Confirmar y Recoger
                    </button>
                </div>
            </div>
        </div>

        <div data-role="page" id="page-signin">
            <div data-role="header" data-theme="c" data-position="fixed">
                <a href="#page-index" data-icon="home" data-iconpos="notext" data-transition="slide" data-direction="reverse"></a>
                <h1>pap</h1>
            </div>
            <div role="main" class="ui-content">
                <h3>Iniciar Sesión</h3>
                <div id="ctn-err" class="bi-invisible"></div>
                <label for="txt-documento">Documento:</label>
                <input type="text" name="txt-documento" id="txt-documento" value="">
                <label for="txt-password">Contraseña:</label>
                <input type="password" name="txt-password" id="txt-password" value="">
                <fieldset data-role="controlgroup">                
                    <label><input type="checkbox" name="chk-keep-signed-in" id="chk-keep-signed-in"> Recordarme</label>
                </fieldset>
                <a href="#dlg-invalid-credentials" data-rel="popup" data-transition="pop" data-position-to="window" id="btn-submit" 
                   class="ui-btn ui-btn-b ui-corner-all bi-top-margin-1-5">Ingresar</a>
                <p class="bi-top-margin-1-5"><a href="#begin-password-reset-page">Olvidaste tu contraseña?</a></p>
            </div>
        </div>

        <div id="divRegistrarUsuario" data-role="page" >
            <div data-role="header" data-position="fixed">
                <a href="#" class="ui-btn ui-corner-all ui-icon-carat-l ui-btn-icon-notext" data-rel="back">Back Icon</a>
                <h1>Registro Usuario</h1>
            </div>
            <div>
                <p>Tipo de Documento:
                    <select id="tipoDocumentoUsuario">
                        <option value="1">CEDULA DE CIUDADANIA</option>
                        <option value="2">TARJETA DE IDENTIDAD</option>                        
                        <option value="4">CEDULA DE EXTRANJERIA</option>
                    </select>
                </p>
                <p>Documento:<input id="documentoUsuario"/></p>
                <p>Nombre(s): <input id="nombreUsuario"/></p>
                <p>Apellido(s): <input id="apellidoUsuario"/></p>

                <p>EPS:
                    <select id="epsUsuario" data-native-menu="false">
                        <option value="-1">Seleccione</option>
                    </select>
                </p>

                <p>Fecha de Nacimiento:
                    <input type="date" id="fechaNacimientoUsuario">
                </p>

                <p>Sexo:</p>
                <div id="radio">
                    <input type="radio" id="radio1" name="radio" checked="checked" value="F" /><label for="radio1">Femenino</label>
                    <input type="radio" id="radio2" name="radio" value="M"/><label for="radio2">Masculino</label>
                </div>

                <p>Departamento Residencia:
                    <select id="departamentoUsuario" onchange="cargarMunicipios(this.value)">
                        <option value="-1">Seleccione</option>
                    </select>
                </p>

                <p>Ciudad Residencia:
                    <select id="municipioUsuario" >
                        <option value="-1">Seleccione</option>
                    </select>
                </p>

                <p>Dirección: <input id="direccionUsuario"/></p>
                <p>Correo Electrónico: <input id="correoUsuario"/></p>
                <p>Número Teléfono Fijo: <input id="telefonoUsuario"/></p>
                <p>Número Teléfono Celular: <input id="celularUsuario"/></p>
                <p>Contraseña: <input id="claveUsuario" type="password"/></p>
                <p>Repita la Contraseña: <input id="claveConfirmacionUsuario" type="password"/></p>

                <textarea rows="15" cols="50" id="textareaAcuerdo"
                          readonly style="resize: none;">
                </textarea>

                <input type="checkbox" id="acuerdoUsuario" value="AceptaAcuerdo"
                       onchange="document.getElementById('bnRegistrarUsuario').focus()"/>
                <label for="acuerdoUsuario">He leído y acepto.</label>

                <button id="bnRegistrarUsuario" class="btn btn-block" onclick="registrarUsuario()">
                    Crear Usuario
                </button>
            </div>
        </div>
    </body>
</html>
